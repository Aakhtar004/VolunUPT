1. An√°lisis y Definici√≥n del Proyecto (VolunUPT)
La idea ha evolucionado de un simple gestor de eventos a un Sistema Integral de Gesti√≥n de Programas de Voluntariado. Este enfoque es significativamente m√°s robusto y refleja mejor las necesidades de una universidad.

Puntos Fuertes del Modelo Actual
Jerarqu√≠a Realista: El modelo Evento Base (Programa) > Subevento (Actividad) es como funciona el voluntariado (ej. un programa de reforestaci√≥n tiene subeventos de capacitaci√≥n, siembra y riego).

Valoraci√≥n Precisa: El seguimiento por horas es m√°s justo y valioso que la simple "asistencia". Permite recompensar el esfuerzo real.

Certificaci√≥n Automatizada: El objetivo final de "certificar por horas acumuladas" en un programa espec√≠fico (Evento Base) automatiza la tarea m√°s tediosa para la administraci√≥n de RSU.

Flujo de Control (QR + Validaci√≥n): El flujo de "Check-in con QR" (Estudiante) seguido de "Validaci√≥n de Horas" (Coordinador) es seguro, flexible y previene fraudes.

Tecnolog√≠a Enfocada: Usar el stack 100% Firebase (Auth, Firestore, Storage, Functions) es una elecci√≥n moderna, escalable y eficiente en costos.

Consideraciones Clave
Validaci√≥n de Usuarios: Al usar solo Google Auth, la √∫nica forma de validar que un usuario pertenece a la UPT es restringiendo el inicio de sesi√≥n a un dominio de correo espec√≠fico (ej. @upt.pe o @alumnos.upt.pe). Esto debe configurarse en Firebase Auth y en el c√≥digo.

L√≥gica de Negocio en el Backend: Tareas cr√≠ticas como la suma de horas y la generaci√≥n de certificados deben ocurrir en el backend usando Cloud Functions para garantizar la integridad de los datos y la eficiencia.

2. Stack Tecnol√≥gico (Firebase)
Todo el sistema operar√° sobre la plataforma de Firebase.

Firebase Authentication: Para la autenticaci√≥n de usuarios. Se usar√° exclusivamente el proveedor de Google.

Cloud Firestore: Base de datos NoSQL para almacenar todos los datos (usuarios, eventos, inscripciones, asistencias).

Firebase Storage: Para almacenar archivos, principalmente los certificados PDF generados y las im√°genes de portada de los eventos.

Cloud Functions for Firebase: Para ejecutar l√≥gica de backend (Node.js/TypeScript) de forma segura:

Generar los PDF de certificados.

Sumar (agregar) horas de forma as√≠ncrona tras la validaci√≥n.

Crear el documento de usuario en Firestore en el primer login.

Enviar notificaciones push.

Firebase Cloud Messaging (FCM): Para enviar notificaciones push (recordatorios, certificados listos).

3. Flujo de Autenticaci√≥n y Perfil
Autenticaci√≥n (Google Auth)
El usuario abre la app y ve una √∫nica opci√≥n: "Ingresar con Google".

El SDK de Firebase Auth inicia el flujo de Google Sign-In.

Restricci√≥n Cr√≠tica: El sistema solo permitir√° cuentas de Google que pertenezcan al dominio institucional de la UPT (ej. @upt.pe). Si el usuario elige una cuenta de @gmail.com, la app mostrar√° un error.

Primer Inicio de Sesi√≥n:

Tras una autenticaci√≥n exitosa, una Cloud Function (con el trigger functions.auth.user().onCreate()) se disparar√°.

Esta funci√≥n crear√° un nuevo documento en la colecci√≥n users en Firestore.

Copiar√° los datos de Google: uid, email, displayName, photoURL.

Asignar√° por defecto el role: "estudiante".

Apartado: Perfil de Usuario (Com√∫n a todos los roles)
Esta pantalla ser√° visible para todos los usuarios logueados.

Informaci√≥n Mostrada (No editable):

Foto de perfil (tomada de photoURL de Google).

Nombre completo (tomado de displayName de Google).

Correo institucional (email).

Informaci√≥n de la App (Calculada):

Rol Actual: "Estudiante", "Coordinador" o "Administrador".

Horas Totales Acumuladas: Un contador de todas las horas validadas en todos los eventos.

Acciones:

Cerrar Sesi√≥n: Termina la sesi√≥n de Firebase Auth.

Ayuda y Soporte: (Futuro) Enlace a un formulario o contacto.

Mis Certificados: Acceso directo a la lista de certificados obtenidos.

4. Modelo de Datos (Colecciones Firestore)
Estos son los modelos "definidos desde el c√≥digo".

users
Almacena la informaci√≥n de cada usuario en la plataforma.

uid (string): ID de Firebase Auth (es el ID del documento).

email (string): Correo institucional.

displayName (string): Nombre del usuario.

photoURL (string): Link a la foto de perfil.

role (string): "estudiante", "coordinador" o "admin".

totalHours (number): Contador denormalizado del total de horas hist√≥ricas (actualizado por Cloud Function).

events (Eventos Base / Programas)
Almacena los programas de voluntariado.

eventId (string): ID del documento.

title (string): "Programa de Reforestaci√≥n 2025".

description (string): Detalles del programa.

imageUrl (string): URL de Firebase Storage de la imagen de portada.

coordinatorId (string): uid del coordinador a cargo.

status (string): "borrador", "publicado", "completado", "archivado".

totalHoursForCertificate (number): Horas necesarias para obtener el certificado (ej. 20).

subEvents (Subeventos / Actividades)
Almacena las actividades espec√≠ficas de cada Evento Base.

subEventId (string): ID del documento.

baseEventId (string): ID del event al que pertenece.

title (string): "Capacitaci√≥n", "Jornada de Siembra 1".

date (timestamp): Fecha de la actividad.

startTime / endTime (timestamp): Horas de la actividad.

location (string): Lugar.

maxVolunteers (number): Cupos disponibles.

registeredCount (number): Contador de inscritos (para control de cupos).

qrCodeData (string): Un UUID √∫nico generado para este subevento, ser√° el contenido del QR.

registrations (Inscripciones)
Registra la inscripci√≥n de un estudiante a un subevento.

registrationId (string): ID del documento.

userId (string): uid del estudiante.

subEventId (string): ID del subevento.

baseEventId (string): ID del evento base (para consultas).

registeredAt (timestamp): Fecha de inscripci√≥n.

attendanceRecords (Registros de Asistencia)
El n√∫cleo del sistema. Registra el check-in y las horas.

recordId (string): ID del documento.

userId (string): uid del estudiante.

subEventId (string): ID del subevento.

baseEventId (string): ID del evento base.

checkInTime (timestamp): Hora exacta del escaneo QR.

status (string): "checked-in" (reci√©n escaneado), "validated" (horas asignadas), "absent".

hoursEarned (number): Horas asignadas por el coordinador (ej. 4.5).

validatedBy (string): uid del coordinador que valid√≥.

validatedAt (timestamp): Hora de la validaci√≥n.

certificates
Almacena los certificados generados para que el usuario los descargue.

certificateId (string): ID del documento.

userId (string): uid del estudiante.

baseEventId (string): ID del event por el cual se emite.

pdfUrl (string): URL de Firebase Storage del PDF.

dateIssued (timestamp): Fecha de emisi√≥n.

hoursCompleted (number): Total de horas con las que se emiti√≥.

5. Funcionalidades Detalladas por Rol
A. Rol: Estudiante üßë‚Äçüéì
Objetivo: Descubrir, participar y ser certificado por su voluntariado.

Acciones:

Autenticaci√≥n:

Iniciar sesi√≥n √∫nicamente con su cuenta de Google UPT.

Exploraci√≥n:

Ver un "Dashboard" con pr√≥ximos subeventos inscritos y sugerencias de Eventos Base.

Explorar la lista de todos los events (Programas) publicados.

Filtrar eventos por categor√≠as (si se a√±aden) o buscar por nombre.

Inscripci√≥n:

Seleccionar un Evento Base para ver su descripci√≥n y su lista de subEvents.

Inscribirse a un subEvent espec√≠fico (crea un doc en registrations). La app debe validar cupos (registeredCount < maxVolunteers).

Cancelar una inscripci√≥n (ej. hasta 24h antes del subevento).

Participaci√≥n (D√≠a del Evento):

Acceder a la funci√≥n de "Escanear QR" desde la app.

Escanear el QR que el coordinador muestra. La app env√≠a el userId y el qrCodeData (que identifica al subEventId) a Firebase.

Se crea un registro en attendanceRecords con status: "checked-in".

Seguimiento y Certificaci√≥n:

Ver la pantalla "Mi Progreso" para cada Evento Base en el que participa (ej. "Programa Reforestaci√≥n: 12.5 / 20 horas").

Recibir una notificaci√≥n push cuando un coordinador valide sus horas.

Recibir una notificaci√≥n push cuando haya alcanzado las horas y su certificado est√© listo.

Acceder a la secci√≥n "Mis Certificados", ver la lista de certificates y descargar los PDF.

B. Rol: Coordinador / Gestor RSU üßë‚Äçüè´
Objetivo: Crear, gestionar y validar las actividades de voluntariado.

Acciones:

Autenticaci√≥n:

Iniciar sesi√≥n con su cuenta de Google UPT (que un Admin debe haber promovido a role: "coordinador").

Gesti√≥n de Programas (Eventos Base):

CRUD (Crear, Leer, Actualizar, Borrar) de los events (Programas) que √©l administra.

Definir el title, description, imageUrl y, lo m√°s importante, totalHoursForCertificate.

Publicar o despublicar un Evento Base.

Gesti√≥n de Actividades (Subeventos):

CRUD de subEvents asociados a sus Eventos Base.

Definir title, date, location, maxVolunteers, etc.

Monitorear la lista de inscritos (registrations) para cada subevento.

Gesti√≥n de Asistencia (D√≠a del Evento):

Seleccionar el subEvent del d√≠a.

Validaci√≥n de Horas (Post-Evento):

Acceder a la lista de estudiantes que hicieron check-in (lee attendanceRecords con status: "checked-in" para ese subEventId).

Ingresar las horas reales para cada estudiante (ej. "Ana Garc√≠a: 4h", "Luis Vega: 2.5h").

Confirmar la validaci√≥n. Esto actualiza los registros a status: "validated", guarda las hoursEarned y dispara la Cloud Function para la suma.

C. Rol: Administrador üëë
Objetivo: Supervisar la plataforma, gestionar usuarios y obtener estad√≠sticas.

Acciones:

Autenticaci√≥n:

Iniciar sesi√≥n con su cuenta de Google UPT (con role: "admin").

Gesti√≥n de Usuarios:

Ver la lista completa de todos los users en la plataforma.

Funci√≥n Clave: Asignar Roles. El Admin es el √∫nico que puede cambiar el role de un usuario de "estudiante" a "coordinador" o "admin".

Desactivar/suspender cuentas de usuario.

Supervisi√≥n de Contenido:

Ver, editar o eliminar cualquier event o subEvent de la plataforma, sin importar qu√© coordinador lo cre√≥.

Validar asistencias manualmente si un coordinador no puede hacerlo.

Estad√≠sticas y Reportes:

Acceder a un Dashboard global con estad√≠sticas:

Total de horas de voluntariado de la UPT.

N√∫mero de estudiantes activos.

Eventos m√°s populares.

Total de certificados emitidos.

(Futuro) Exportar datos a CSV para informes de RSU.